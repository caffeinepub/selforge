{
  "kind": "build_request",
  "title": "Improve restaurant menu nutrition fetching (Google-like search) for free-text meal inputs",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the free-text meal parsing so inputs like \"2 kfc veg zinger burger\" are parsed as a single food item with the full name (including multi-word restaurant/menu items) and a sensible default portion estimate for items like burgers (per piece) instead of truncating to 2–3 words or assuming unrealistic grams.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "i write 2 kfc veg zinger burger and it dont fetches data"
        ]
      },
      "acceptanceCriteria": [
        "Entering \"2 kfc veg zinger burger\" results in a parsed food item whose name includes \"kfc\" and \"veg zinger burger\" (not truncated to only the first 2–3 words).",
        "The parser treats \"2 <menu item>\" as 2 pieces (not 2g) when no explicit unit is provided.",
        "Portion estimation for burger-like items defaults to a higher per-piece gram estimate than the generic 50g piece (so total grams for 2 burgers is plausibly >100g)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add a new nutrition lookup step that uses a Google-like web search API (Google Custom Search JSON API) to find nutrition facts for restaurant/menu items when Open Food Facts does not return a match, and use that result before falling back to AI estimation or local defaults.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "bro just connect this to google or smth bcz its not working",
          "ask toa uth with chat gpt and whatever i tell in description menu it just ask chatgpt for all things and for data"
        ]
      },
      "acceptanceCriteria": [
        "If Open Food Facts returns not-found for a query like \"KFC veg zinger burger\", the app attempts a web-search-based lookup next.",
        "The web-search integration is configurable via environment variables (do not hardcode keys in source).",
        "When the search API is not configured or fails, the app continues gracefully to the existing DeepSeek/local fallback without breaking the UI.",
        "The nutrition result includes an explicit nutritionSource value that distinguishes search-based results from 'online' (Open Food Facts), 'deepseek', and 'local'."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Extract usable nutrition numbers (at minimum calories; protein/sugar when available) from web-search results (e.g., result snippet text) with robust, unit-aware heuristics (kcal/calories, grams), and scale results according to the parsed quantity/portion.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "it dont fetches data jist . ... ask chatgpt for all things and for data"
        ]
      },
      "acceptanceCriteria": [
        "For a search snippet containing a calories value (e.g., \"450 kcal\"), the app can parse and populate calories for the item.",
        "If protein is present in the snippet (e.g., \"25g protein\"), the app parses and populates protein; if absent, protein can remain 0.",
        "Parsed per-item nutrition is scaled to the final gram quantity that the parser/portion estimator computes for the entry.",
        "If parsing yields ambiguous/low-confidence values, the app does not present them as definitive; it should fall back to the next provider (DeepSeek/local) rather than saving incorrect numbers."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Update the Quick Log (Description) results UI to clearly indicate when nutrition came from web search vs Open Food Facts vs AI vs estimation, using English labels, so the user can see that menu items are being fetched from an external source rather than \"asking ChatGPT for everything\".",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "whatever i tell in description menu it just ask chatgpt for all things and for data"
        ]
      },
      "acceptanceCriteria": [
        "For single-item and multi-item food results, the UI shows a source badge that includes a distinct label for the new search-based provider (e.g., \"Web Search\"), separate from existing badges.",
        "All user-facing text for the new provider is in English.",
        "The UI continues to work for gym/cardio entries unchanged."
      ]
    }
  ],
  "constraints": [
    "Use English for any user-facing text.",
    "Do not edit files under frontend/src/components/ui, frontend/src/hooks/useInternetIdentity.ts/tsx, frontend/src/hooks/useActor.ts, or frontend/src/main.tsx (compose them instead).",
    "Backend must remain a single Motoko actor if backend changes are introduced; add migration.mo only if stable state is changed."
  ],
  "nonGoals": [
    "Do not add third-party authentication providers (only Internet Identity is allowed).",
    "Do not add paid/closed-source nutrition databases that require mandatory API keys to function (the web-search step must be optional and gracefully disabled when unconfigured).",
    "Do not implement real-time features (WebSockets/chat).",
    "Do not integrate OpenAI/Anthropic/ChatGPT APIs."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}